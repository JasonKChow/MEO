<!DOCTYPE html>
<html>
<head>
  <title>Rating Faces</title>
  <script src="jspsych-6.0.2/jspsych.js"></script>
  <script src="jspsych-6.0.2/plugins/jspsych-instructions.js"></script>
  <script src="jspsych-6.0.2/plugins/jspsych-html-keyboard-response.js"></script>
  <link href="jspsych-6.0.2/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  <link href="style.css" rel="stylesheet" type="text/css"></link>
</head>
<body></body>
<script>
// Experiment parameters
exposureRepeat = 4;

// Array of array of all faces to select for one condition
var allFaces = [
  [
    'Stimulus/1.jpg',
    'Stimulus/3.jpg',
    'Stimulus/5.jpg',
    'Stimulus/7.jpg',
    'Stimulus/9.jpg',
    'Stimulus/11.jpg',
    'Stimulus/13.jpg',
    'Stimulus/15.jpg',
    'Stimulus/17.jpg',
    'Stimulus/19.jpg',
    'Stimulus/21.jpg',
    'Stimulus/23.jpg',
    'Stimulus/25.jpg',
    'Stimulus/27.jpg',
    'Stimulus/29.jpg',
    'Stimulus/31.jpg',
  ],
  [
    'Stimulus/2.jpg',
    'Stimulus/4.jpg',
    'Stimulus/6.jpg',
    'Stimulus/8.jpg',
    'Stimulus/10.jpg',
    'Stimulus/12.jpg',
    'Stimulus/14.jpg',
    'Stimulus/16.jpg',
    'Stimulus/18.jpg',
    'Stimulus/20.jpg',
    'Stimulus/22.jpg',
    'Stimulus/24.jpg',
    'Stimulus/26.jpg',
    'Stimulus/28.jpg',
    'Stimulus/30.jpg',
    'Stimulus/32.jpg',
  ]
];

// Array of example faces
var exampleFaces = [
  'Stimulus/33.jpg',
  'Stimulus/34.jpg',
  'Stimulus/35.jpg',
  'Stimulus/36.jpg',
  'Stimulus/37.jpg',
  'Stimulus/38.jpg',
  'Stimulus/39.jpg',
  'Stimulus/40.jpg',
];

// Array of squares
var squares = [
  'Stimulus/1-a.png',
  'Stimulus/1-b.png',
  'Stimulus/1-c.png',
  'Stimulus/1-d.png',
  'Stimulus/1-e.png',
  'Stimulus/2-a.png',
  'Stimulus/2-b.png',
  'Stimulus/2-c.png',
  'Stimulus/2-d.png',
  'Stimulus/2-e.png',
  'Stimulus/3-a.png',
  'Stimulus/3-b.png',
  'Stimulus/3-c.png',
  'Stimulus/3-d.png',
  'Stimulus/3-e.png',
  'Stimulus/4-a.png',
  'Stimulus/4-b.png',
  'Stimulus/4-c.png',
  'Stimulus/4-d.png',
  'Stimulus/4-e.png',
  'Stimulus/5-a.png',
  'Stimulus/5-b.png',
  'Stimulus/5-c.png',
  'Stimulus/5-d.png',
  'Stimulus/5-e.png'
];

// Select counterbalance
var counterbalance = ['A', 'B'];
var counterbalanceIndex = Math.floor(Math.random() * counterbalance.length);
counterbalance = counterbalance[counterbalanceIndex];
var faces = allFaces[counterbalanceIndex];

// Start a blank timeline
var timeline = [];

// Instruction pages
var page1 = 'Welcome to the experiment!<br>' +
  'You are going to see pictures of faces with blue squares on top of them.';
var page2 = 'First you will see a cross then a picture of a face with blue' +
  'squares on top. <br>' +
  'Please count the number of blue squares.';
var page3 = 'Response using the number keys for the number of squares you ' +
  'count. Respond as soon as possible. <br>' +
  'Press next for example trials when you are ready.'

// Add an instruction block
timeline.push({
  type: 'instructions',
  pages: [page1, page2, page3],
  show_clickable_nav: true,
  post_trial_gap: 1000
});

// Fixation exposure trial component
var fixation = {
  type: 'html-keyboard-response',
  stimulus: '<p style="font-size: 48px;">+</p>',
  choices: jsPsych.NO_KEYS,
  trial_duration: 100 // NOTE: This is lowered for testing purposes, 400
};

// Presentation exposure trial component
var presentation = {
  type: 'html-keyboard-response',
  stimulus: jsPsych.timelineVariable('stimString'),
  choices: ['1', '2', '3', '4', '5'],
  response_ends_trial: false,
  trial_duration: 100, // NOTE: This is lowered for testing, 1000
  post_trial_gap: 120
};

// Example presentation trial component
var exPresentation = {
  type: 'html-keyboard-response',
  stimulus: jsPsych.timelineVariable('stimString'),
  choices: ['1', '2', '3', '4', '5'],
  response_ends_trial: false,
  trial_duration: 100, // NOTE: This is lowered for testing, 1000
  post_trial_gap: 120
}

// Add example exposure trials to timeline
timeline.push({
  timeline: [fixation, presentation],
  timeline_variables: [
    {stimString: '<img id="faceImg" src="Stimulus/33.jpg"/>' +
      '<img id="squareImg" src="Stimulus/1-c.png"/>'},
    {stimString: '<img id="faceImg" src="Stimulus/34.jpg"/>' +
      '<img id="squareImg" src="Stimulus/3-a.png"/>'},
    {stimString: '<img id="faceImg" src="Stimulus/35.jpg"/>' +
      '<img id="squareImg" src="Stimulus/5-e.png"/>'},
    {stimString: '<img id="faceImg" src="Stimulus/36.jpg"/>' +
      '<img id="squareImg" src="Stimulus/4-d.png"/>'}
  ]
});

var page5 = 'Please keep your eyes on the screen, respond as accurately and ' +
  'quickly as possible.<br>' +
  'Press next when you are ready to begin the real task.'

// Add an post example instruction block
timeline.push({
  type: 'instructions',
  pages: [page5],
  show_clickable_nav: true,
  post_trial_gap: 1000
});

// Build exposure trials
var exposureTrials = [];
var i;
var r;
for (r = 0; r < exposureRepeat; r++) {
  for (i = 0; i < faces.length; i++) {
    exposureTrials = exposureTrials.concat([{stimString:
      '<img id="faceImg" src="' + faces[i] + '"/><img id="squareImg" src="' +
      squares[Math.floor(Math.random() * squares.length)] + '"/>'}]
    );
  }
}

// Add exposure trials to timeline in blocks
for (r = 0; r < exposureRepeat; r++) {
  timeline.push({
    timeline: [fixation, presentation],
    timeline_variables: exposureTrials.slice((faces.length * (r - 1),
      faces.length * r)),
    sample: {
      type: 'without-replacement',
    }
  });
}

// Filler tasks
timeline.push({
  type: 'instructions',
  pages: ['This is where filler would go.'],
  show_clickable_nav: true,
  post_trial_gap: 1000
});

// Presentation component of rating
var rating = {
  type: 'html-keyboard-response',
  stimulus: jsPsych.timelineVariable('ratingString'),
  choies: [37, 39],
  trial_duration: 10000000, // NOTE: This is for CSS styling.
  post_trial_gap: 500, // NOTE: Check on this timing
};

// Build rating trials
var ratingTrials = [];
var novelFaces = allFaces[Math.abs(allFaces.indexOf(faces) - 1)];
for (i = 0; i < faces.length; i++) {
  if (i % 2 === 1) { // Target left
    ratingTrials = ratingTrials.concat({ratingString:
      '<img id="leftImg" src="' + faces[i] + '"/><img id ="rightImg" src="'
      + novelFaces[i] + '"/>', target: 'left'});
  } else { // Target right
    ratingTrials = ratingTrials.concat({ratingString:
      '<img id="leftImg" src="' + faces[i] + '"/><img id ="rightImg" src="'
      + novelFaces[i] + '"/>', target: 'right'});
  }
}

// Add rating trials to timeline
timeline.push({
  timeline: [rating],
  timeline_variables: ratingTrials,
  sample: {
    type: 'without-replacement'
  }
});

// RUN THE TIMELINE!
jsPsych.init({
  timeline: timeline,
  preload_images: squares.concat(allFaces[0], allFaces[1], exampleFaces)
});

</script>
</html>
